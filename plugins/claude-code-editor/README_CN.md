# Claude Code Editor 插件

智能代码编辑和重构插件，通过隔离上下文执行代码修改任务，避免污染主对话窗口。

## 功能特性

- **双模式架构**: Skill 模式（主窗口）+ Sub-agent 模式（隔离上下文）
- **上下文隔离**: 复杂的多轮修改不会污染主对话
- **系统化执行**: 规划 → 执行 → 验证 → 报告的完整工作流
- **质量保证**: 自动验证类型检查、lint、测试等
- **智能决策**: 遇到歧义时主动询问用户

## 适用场景

### ✅ 适合使用的场景

**大规模重构**
- 跨文件重命名函数/类/变量
- 重组目录结构和移动文件
- 改变架构模式（如类组件转 Hooks）
- 提取可复用的工具或组件

**批量修改**
- 在多个相似文件中应用一致的更改
- 文件移动后更新导入路径
- 在整个项目中转换代码风格或模式
- 从一个库/API 迁移到另一个

**模式替换**
- 用现代替代方案替换已弃用的模式
- 标准化错误处理方法
- 将回调模式转换为 async/await
- 更新配置文件格式

**功能实现**
- 实现涉及多个文件的功能
- 添加需要协调更改的新功能
- 在代码库中集成新库

### ❌ 不适合的场景

- 单文件的小改动（使用普通编辑）
- 单点的快速 bug 修复
- 添加简单的注释或文档
- 微小的格式化调整

## 使用方式

### 方式 1: Skill 模式（主对话窗口）

适用于专注、简单的编辑任务：
- 范围明确且定义清晰
- 最多 1-3 个文件
- 不太可能导致连锁错误
- 快速验证

**示例**：
```
将 src/utils/data.ts 中的 processData 重命名为 transformData，并更新其测试
```

### 方式 2: Sub-Agent 模式（隔离上下文）

适用于复杂的多步骤修改：
- 复杂且涉及多个文件
- 需要系统化规划
- 可能需要多次修复迭代
- 会产生大量中间输出

**示例**：
```
将认证系统从 session 重构为使用 JWT
```

Claude Code 会自动判断并使用：
```
subagent_type="claude-code-editor:code-editor-executor"
```

## 决策流程

使用此流程图决定何时委托给 sub-agent：

```
任务是否复杂（3+ 文件或 5+ 处修改）？
  ├─ 否 → 在主对话中处理（skill 模式）
  └─ 是 → 继续评估
      │
      是否需要多轮修复？
        ├─ 否 → 考虑主对话处理
        └─ 是 → 继续评估
            │
            中间步骤是否会让对话混乱？
              ├─ 否 → 主对话即可
              └─ 是 → ✅ 使用 SUB-AGENT 模式
```

## 工作流程

### Sub-Agent 执行流程

#### 阶段 1: 分析与规划
1. 解析任务需求
2. 发现代码库上下文
3. 创建修改计划
4. 识别潜在阻碍

#### 阶段 2: 执行
1. 按计划系统化执行更改
2. 保持一致性
3. 处理依赖关系
4. 内部跟踪进度

#### 阶段 3: 验证
1. 语法和类型检查
2. 测试验证
3. 代码审查自检
4. 手动验证

#### 阶段 4: 报告
1. 成功报告（包含详细摘要）
2. 部分完成报告（需要用户输入）
3. 失败报告（分析和建议）

## 输出格式

### Skill 模式输出

```
✓ 已修改的文件：
  - src/utils/data.ts (重命名 getUserData → fetchUserProfile)
  - src/components/User.tsx (更新函数调用)
  - src/tests/data.test.ts (更新测试用例)

建议的后续步骤：
- 运行测试: npm test
- 检查类型: npm run typecheck
```

### Sub-Agent 模式输出

```
✅ 重构成功完成

变更摘要：
- 修改文件数: 12
- 创建文件数: 3
- 删除文件数: 1
- 代码行变更: ~450

主要修改：
1. 创建 src/services/auth.ts（集中式认证服务）
2. 重构 8 个组件以使用新的认证服务
3. 更新所有认证相关测试
4. 移除已弃用的认证工具

验证结果：
- ✓ 构建通过
- ✓ 类型检查通过
- ✓ 所有测试通过 (125/125)

认证系统已成功重构为使用集中式服务模式。
```

## 高级功能

### 模式识别与应用

批量更改时自动识别并保留：
- 现有代码风格和约定
- 注释模式
- 错误处理方法
- 测试模式

### 智能重构

支持复杂重构：
- 提取函数/组件
- 合并重复代码
- 更新架构

### 迁移策略

库迁移时的系统化方法：
- 映射旧 → 新模式
- 系统化更新导入
- 处理边缘情况
- 更新测试

## 类型安全规则

Sub-agent 严格遵守类型安全，**绝不使用**：
- `any` 类型
- `@ts-ignore` 注释
- `@ts-expect-error` 注释
- 类型断言（`as` 关键字）
- 非空断言（`!` 操作符）
- ESLint disable 注释

**只使用正确的修复方式**：
- 定义显式类型
- 使用类型守卫
- 添加适当的类型定义
- 必要时重构代码结构

## 集成其他插件

本插件可与以下插件配合使用：

- **typescript-strict-typing**: 重构期间确保类型安全
- **code-quality-standards**: 修改后运行质量检查
- **git-commit-conventions**: 为更改创建规范的提交

## 使用示例

### 示例 1: 函数重命名（Skill 模式）

```
用户: "在整个项目中将 getUserData 重命名为 fetchUserProfile"

助手（Skill 模式 - 直接处理）:
1. 使用 Grep 查找所有出现位置
2. 使用 Read 检查每个文件
3. 使用 Edit 在每个位置重命名
4. 报告完成并列出文件清单
```

### 示例 2: 架构重构（Sub-Agent 模式）

```
用户: "将认证重构为使用集中式认证服务"

助手（委托给 sub-agent）:
"我将把这个任务委托给 code-editor-executor sub-agent，因为它涉及：
- 创建新服务文件
- 重构多个组件
- 更新整个项目的导入
- 修改测试

Sub-agent 将在隔离环境中工作，完成后报告结果。"

[使用 Task 工具，subagent_type="claude-code-editor:code-editor-executor"]
```

### 示例 3: 库迁移（Sub-Agent 模式）

```
用户: "在整个代码库中从 moment.js 迁移到 date-fns"

助手（委托给 sub-agent）:
[使用详细迁移计划生成 sub-agent]

Sub-agent 执行：
1. 查找所有 moment.js 用法
2. 替换为 date-fns 等价物
3. 更新导入
4. 从依赖中移除 moment.js
5. 运行测试并修复问题
6. 报告完成摘要
```

## Sub-Agent 何时寻求帮助

Sub-agent 在以下情况会停止并寻求指导：
- 遇到设计歧义
- 在代码库中发现冲突模式
- 无法确定正确方法
- 遇到无法解决的意外错误
- 需要架构决策

这确保了质量，同时为机械性任务保持自主性。

## 最佳实践

1. **明确具体**: 提供清晰、可操作的描述
2. **提供上下文**: 包含相关文件路径和模式
3. **设定期望**: 定义"成功"的标准
4. **从小做起**: 对于大型重构，考虑分阶段进行
5. **验证结果**: 始终审查更改并运行测试

## 限制

- 没有指导无法做出主观设计决策
- 复杂的架构更改需要明确指令
- 遇到模糊情况时可能需要用户输入
- 不应用于探索性编码（用于明确定义的任务）

## 版本信息

- **版本**: 1.0.0
- **作者**: LeekJay
- **仓库**: https://github.com/LeekJay/claude-skills-plugin

## 许可证

本插件遵循与主仓库相同的许可证。
